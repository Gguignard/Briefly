# config/kamal.yml
#
# AVANT DÉPLOIEMENT - Remplacer les placeholders:
#   1. IP_VPS_OVH → IP publique du VPS (ex: 51.91.xxx.xxx)
#   2. briefly.yourdomain.com → domaine de production
#   3. Configurer les secrets: kamal env push
#
service: briefly
image: briefly-app

servers:
  web:
    - IP_VPS_OVH  # TODO: Remplacer par l'IP du VPS OVH

registry:
  server: ghcr.io
  username:
    - KAMAL_REGISTRY_USERNAME
  password:
    - KAMAL_REGISTRY_PASSWORD

builder:
  dockerfile: docker/Dockerfile
  context: .

env:
  clear:
    NODE_ENV: production
    PORT: "3000"
  secret:
    - NEXT_PUBLIC_SUPABASE_URL
    - NEXT_PUBLIC_SUPABASE_ANON_KEY
    - SUPABASE_SERVICE_ROLE_KEY
    - CLERK_SECRET_KEY
    - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
    - REDIS_URL
    - SENTRY_DSN

proxy:
  ssl: true
  host: briefly.yourdomain.com  # TODO: Remplacer par le domaine de production
